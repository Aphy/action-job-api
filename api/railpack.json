{
  "$schema": "https://schema.railpack.com",

  "steps": {
    "install": {
      "inputs": [
        { "image": "composer:2" },
        { "local": true }
      ],
      "commands": [
        "composer install --no-dev --prefer-dist --no-interaction --optimize-autoloader --no-scripts -vvv"
      ],
      "deployOutputs": [{ "include": ["/app/vendor"] }]
    },

    "build": {
      "inputs": [
        { "step": "install" }
      ],
      "commands": [
        "composer dump-autoload -o || true"
      ],
      "deployOutputs": [{ "include": ["."] }]
    }
  },

  "deploy": {
    "inputs": [
      { "step": "build", "include": ["."] }
    ],
    "variables": {
      "APP_ENV": "prod"
    },
    "startCommand": "./entrypoint.sh"
  }
}
